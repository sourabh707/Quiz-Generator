<div onload="doSetup()"></div>
<div class="container">
  <div class="box form_title">
    <div id="title"></div>
    <div id="desc"></div>
  </div>

  <form id="main">
    <input type="number" min="1" class="ID" placeholder="Roll Number">
  </form>
  <div class="result">
    <div class="create-button" id="submit_form">Submit</div>
    {{!-- <div class="cancel-button">Cancel</div> --}}
  </div>

</div>

<script>
  let mainContainer = document.getElementById("main");
  const title = document.querySelector('#title');
  const desc = document.querySelector('#desc');
  title.innerHTML = "First form";



  function fn(bool, e) { //console.log(bool);
    if (bool) {
     additional.childNodes[1].innerHTML += `<span class='star'>*</span>`;
  
    }
  }



  var docRef = db.collection('form').doc("First form");

  docRef.get().then((doc) => {
    desc.innerHTML = doc.data().desc;



  }).catch((error) => {
    console.log("Error getting document:", error);
  });
  var count = 3;
  docRef.collection("hi").get()
    .then((querySnapshot) => {
      querySnapshot.forEach((doc) => {
        // doc.data() is never undefined for query doc snapshots
        //console.log(doc.id, " => ", doc.data());
        var curr = doc.id;
        var len = curr.length;


        if (curr[len - 1] == 'T') {
          var qs = doc.data().qs;
          
          //console.log(qs);
          additional = document.createElement("div");
          additional.className = 'textType';
          additional.innerHTML += `
    
     <p class="hi">Hi </p>
      <textarea type="text" class="sample-text" oncopy="return false" onpaste="return false" oncut="return false">
        Type your answer here
      </textarea>
      
      <div class="seperator">

      </div>
      <div class="question-control">


          
        </div></i></div>
      </div>
            `


          additional.classList.add("box");
          mainContainer.appendChild(additional);

          mainContainer.childNodes[count].childNodes[1].innerHTML = qs;
          fn(doc.data().req, mainContainer.childNodes[count].childNodes[5].childNodes[3]);
          

          count++;
        }

        if (curr[len - 1] == 'U') {
          var qs = doc.data().qs;
          
          //console.log(qs);
          additional = document.createElement("div");
          additional.className = 'uploadType';
          additional.innerHTML = `
    
     <p class="hi">Hi</p>
      <input type="file" class="sample-text" >
        
      
       
      
      <div class="seperator">

      </div>
      <div class="question-control">
     
        
       
          
        </div></i></div>
      </div>
            `


          additional.classList.add("box");
          mainContainer.appendChild(additional);

          mainContainer.childNodes[count].childNodes[1].innerHTML = qs;

          fn(doc.data().req, mainContainer.childNodes[count].childNodes[5].childNodes[3]);
          count++;

        }

        if (curr[len - 1] == 'O') {
          var qs = doc.data().qs;
         
          //console.log(qs);
          additional = document.createElement("div");

          additional.className = "mcqType";
          additional.innerHTML = `
      <p class="hi">Hi</p>
     
      <div id="possible">
        <div class="indivisual">
          
        </div>
      </div>
      <div class="seperator"></div>
     <div class="question-control">
     
        
        
          
        </div></i></div>
      </div>`
          additional.classList.add("box");
          mainContainer.appendChild(additional);
          mainContainer.childNodes[count].childNodes[1].innerHTML = qs;


          fn(doc.data().req, mainContainer.childNodes[count].childNodes[7].childNodes[3]);
          var option = doc.data().op;
          //  console.log(option);
          for (var i = 1; i <= option.length; i++) {
            var data = document.createElement('div');
            data.className = "prik";
            var p2 = document.createElement('input');
            p2.type = "checkbox";

            // p2.innerHTML=i+")    "+option[i-1];


            p2.name = "options_here"
            var opt = document.createElement('p');
            opt.innerHTML = "    " + option[i - 1];
            data.appendChild(p2);
            data.appendChild(opt);



            mainContainer.childNodes[count].childNodes[3].childNodes[1].appendChild(data);

          }
          count++;


        }


      });
    })
    .catch((error) => {
      console.log("Error getting documents: ", error);
    });


</script>

<script>

  const form = document.getElementById("main");
  const button = document.querySelector("#submit_form");
  const req = document.getElementById("switch");



  var count1 = 1;

  button.addEventListener('click',
    (e) => {


      //console.log(title.value);

      //  db.collection('form').doc(title.value).collection('ans').doc()
      var ID;
      for (var child = form.firstChild; child !== null; child = child.nextSibling) {

        if (child.className == 'ID') {
          ID = child.value;
          //console.log("hi");

        }
        //text type
        if (child.className == 'textType box') {

          // console.log(child.childNodes[2].childNodes[1].value);
          db.collection('form').doc(title.innerHTML).collection("ans").doc(ID).collection(String(count1)).doc('ans_doc').set({
            ans: child.childNodes[2].childNodes[1].value,

          });
          count1++;

        }

        //mcq type
        if (child.className == 'mcqType box') {


          var mcq_ans = [];
          for (var i = 1; child.childNodes[3].childNodes[1].childNodes[i] != null; i++) {
            //console.log(child.childNodes[3].childNodes[1].childNodes[i].childNodes[0].checked);
            mcq_ans[i - 1] = child.childNodes[3].childNodes[1].childNodes[i].childNodes[0].checked;

          }
          db.collection('form').doc(title.innerHTML).collection("ans").doc(ID).collection(String(count1)).doc('ans_doc').set({
            ans: mcq_ans,

          });
          count1++;

        }


        //upload file

        let storageRef = firebase.storage().ref(title.innerHTML + "/" + ID);

        if (child.className == 'uploadType box') {

          let file = child.childNodes[2].childNodes[1].files[0];
          console.log(file);
          let this_ref = storageRef.child('ans');

          this_ref.put(file).then(res => {
            console.log('done');
          }).catch(e => {
            console.log('error uploading' + e);
          })


        }




      }
    }
  )

</script>